{% extends "base.html" %}

{% block content %}
<div class="container mt-5">

  <!-- ğŸ” í—¤ë” -->
  <header class="text-center mb-5 p-4 rounded bg-gradient" style="background: linear-gradient(to right, #e3f2fd, #bbdefb);">
    <h5 class="text-muted">ğŸ“ˆ ì£¼ì‹, íˆ¬ììë“¤ì€ ì–´ë–»ê²Œ ë§í• ê¹Œìš”?</h5>
    <h1 class="fw-bold display-5 mb-3">
      {% if company_name %}
        <span class="text-primary">{{ company_name }}</span> ì£¼ì‹ ëŒ“ê¸€ ì‚´í´ë³´ê¸°
      {% else %}
        ì£¼ì‹ ëŒ“ê¸€ ì‚´í´ë³´ê¸°
      {% endif %}
    </h1>
    <hr class="w-50 mx-auto border-2 border-primary">
  </header>

  <!-- ğŸ¢ íšŒì‚¬ ê²€ìƒ‰ í¼ -->
  <div class="card shadow-sm p-4 mb-5">
    <form class="row g-3 align-items-end" action="{% url 'crawlings:index' %}" method="post">
      {% csrf_token %}
      <div class="col-md-9">
        <label for="company_name" class="form-label">íšŒì‚¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</label>
        <input type="text" id="company_name" name="company_name" class="form-control form-control-lg"
               placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" value="{{ company_name }}">
      </div>
      <div class="col-md-3 text-end">
        <button type="submit" class="btn btn-primary btn-lg w-100">ğŸ” ê²€ìƒ‰</button>
      </div>
    </form>
  </div>

  {% if analysis %}
<!-- ğŸ“Š ëŒ“ê¸€ ë¶„ì„ ìš”ì•½ ì¹´ë“œ -->
<div class="card shadow-lg border-0 mb-5" style="background-color: #f8f9fa;">
  <div class="card-body">

    <!-- ì œëª© -->
    <h4 class="card-title mb-4">
      <i class="bi bi-bar-chart-line-fill text-primary"></i> {{ company_name }} ëŒ“ê¸€ ìš”ì•½
    </h4>

    <!-- ë¶„ì„ ê²°ê³¼ íŒŒì‹± -->
    {% with lines=analysis|linebreaksbr|safe %}
      {% for line in lines.splitlines %}
        {% if '1. ì „ì²´ ì—¬ë¡ :' in line %}
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div class="ms-2 me-auto">
              <div class="fw-bold">ì „ì²´ ì—¬ë¡ </div>
              {% if 'ê¸ì •' in line %}
                <span class="badge bg-success rounded-pill">ê¸ì •</span>
              {% elif 'ë¶€ì •' in line %}
                <span class="badge bg-danger rounded-pill">ë¶€ì •</span>
              {% else %}
                <span class="badge bg-secondary rounded-pill">ì¤‘ë¦½</span>
              {% endif %}
            </div>
          </li>
        {% elif '2. ê¸ì •ì  í‚¤ì›Œë“œ:' in line %}
          <li class="list-group-item">
            <div class="fw-bold text-success">ê¸ì •ì  í‚¤ì›Œë“œ</div>
            {{ line|cut:"2. ê¸ì •ì  í‚¤ì›Œë“œ:" }}
          </li>
        {% elif '3. ë¶€ì •ì  í‚¤ì›Œë“œ:' in line %}
          <li class="list-group-item">
            <div class="fw-bold text-danger">ë¶€ì •ì  í‚¤ì›Œë“œ</div>
            {{ line|cut:"3. ë¶€ì •ì  í‚¤ì›Œë“œ:" }}
          </li>
        {% elif '4. ì¢…í•© ë¶„ì„ ìš”ì•½:' in line %}
          <li class="list-group-item">
            <div class="fw-bold">ì¢…í•© ë¶„ì„ ìš”ì•½</div>
            <p class="mb-0">
              {{ line|cut:"4. ì¢…í•© ë¶„ì„ ìš”ì•½:" }}
            </p>
          </li>
        {% endif %}
      {% endfor %}
    {% endwith %}

    </div>
  </div>
  {% endif %}


  <!-- ğŸ’¬ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
  <section class="mt-5">
    <h4 class="fw-semibold mb-3">ğŸ’¬ ëŒ“ê¸€ ìƒì„¸</h4>
    {% if comments %}
      <ul class="list-group shadow-sm">
        {% for comment in comments %}
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <span>{{ comment.comment }}</span>
            <form action="{% url "crawlings:delete_comment" comment.pk %}" method="post" class="ms-3">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger">
                ğŸ—‘ ì‚­ì œ
              </button>
            </form>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </section>

</div>
{% endblock content %}